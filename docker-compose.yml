services:
  demakai-franken:
    container_name: demakai-franken
    restart: unless-stopped
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - PUID=1000
      - PGID=1000
      - APP_ENV=production
      - APP_DEBUG=false
      - SERVER_NAME=:80
    ports:
      - "8003:80"
    # Removed volume bind mount for production to use built image code
    networks:
      - postgres-stack_ai_net

  demakai-worker:
    container_name: demakai-worker
    restart: unless-stopped
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      - PUID=1000
      - PGID=1000
      - APP_ENV=production
      - QUEUE_CONNECTION=database
    command: "php artisan queue:work --sleep=3 --tries=3 --max-time=3600"
    # Removed volume bind mount for production
    networks:
      - postgres-stack_ai_net

  tika:
    image: apache/tika:latest
    container_name: demakai-tika
    restart: unless-stopped
    ports:
      - "9999:9999"
    networks:
      - postgres-stack_ai_net

networks:
  postgres-stack_ai_net:
    external: true
